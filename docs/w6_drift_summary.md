# Data Drift Summary

## Overview

This document tracks data drift detection reports generated by Evidently AI. Data drift indicates when the distribution of incoming features differs significantly from the training data, which can degrade model performance.

## Drift Detection Schedule

### Automated Reports

**Frequency:** Weekly (every Monday at 2 AM UTC)

**Command:**
```bash
python scripts/generate_evidently_report.py \
  --features data/processed/features_replay.parquet \
  --output reports/evidently/train_test_drift_report.html \
  --report_type train_test
```

**Location:** `reports/evidently/train_test_drift_report.html`

### Manual Reports

Generate on-demand for:
- After major data collection sessions
- Before model retraining
- When performance degrades unexpectedly

**Command:**
```bash
python scripts/generate_evidently_report.py \
  --features data/processed/features_replay.parquet \
  --output reports/evidently/data_drift_report.html \
  --report_type data_drift
```

## Drift Thresholds

### Feature-Level Drift

- **Low Drift:** p-value > 0.05 (no significant drift detected)
- **Medium Drift:** 0.01 < p-value ≤ 0.05 (moderate drift, monitor closely)
- **High Drift:** p-value ≤ 0.01 (significant drift, consider retraining)

### Dataset-Level Drift

- **Drift Detected:** When > 50% of features show drift
- **Action Required:** When > 75% of features show drift

## Recent Drift Reports

### 2025-12-05 - Production Monitoring Report

**Report:** `docs/Evidently_report.pdf` | `reports/evidently/production_monitoring_report.html`

**Comparison:**
- **Reference Data:** 3,500 rows (historical/training baseline)
- **Current Data:** 53,490 rows (live production data)
- **Report Type:** Production monitoring (reference vs current)

**Summary:**
- **Features Analyzed:** 10 (MODEL_FEATURES from feature_preparation.py)
- **Dataset Drift Status:** ⚠️ **DETECTED** (Threshold: 0.5)
- **Drifted Features:** 8 out of 10 (80%)
- **Data Quality:** ✅ No missing values in either dataset

**Drift Severity by Feature:**

| Feature | Drift Status | Drift Score | Severity |
|---------|--------------|-------------|----------|
| `spread_mean_300s` | ⚠️ Detected | 4.482 | **High** |
| `spread_mean_60s` | ⚠️ Detected | 3.419 | **High** |
| `price_velocity_300s` | ⚠️ Detected | 2.432 | **High** |
| `trade_intensity_300s` | ⚠️ Detected | 1.614 | **Medium** |
| `order_book_imbalance_300s` | ⚠️ Detected | 0.799 | **Medium** |
| `order_book_imbalance_60s` | ⚠️ Detected | 0.381 | **Low** |
| `log_return_300s` | ⚠️ Detected | 0.343 | **Low** |
| `order_book_imbalance_30s` | ⚠️ Detected | 0.306 | **Low** |
| `realized_volatility_60s` | ✅ Not Detected | 0.028 | None |
| `realized_volatility_300s` | ✅ Not Detected | 0.027 | None |

**Key Findings:**
- **Critical Drift:** Spread-related features (`spread_mean_300s`, `spread_mean_60s`) show very high drift (scores > 3.0), indicating significant changes in bid-ask spread behavior
- **Market Regime Change:** High drift in `price_velocity_300s` (2.432) and `trade_intensity_300s` (1.614) suggests different market conditions between training and production
- **Stable Volatility Features:** Both `realized_volatility_300s` and `realized_volatility_60s` show minimal drift (< 0.03), indicating consistent volatility patterns
- **Order Book Drift:** All order book imbalance features show some drift, with longer windows (300s) showing higher drift than shorter windows (30s, 60s)
- **Overall Assessment:** 80% of features drifted, exceeding the 75% "Action Required" threshold

**Actions Taken:**
- ✅ Generated production monitoring report comparing reference data vs live production data
- ✅ Documented drift findings in this summary
- ⏳ **Recommended:** Monitor model performance (PR-AUC) for degradation
- ⏳ **Recommended:** Consider model retraining if performance drops > 5%
- ⏳ **Recommended:** Investigate market conditions causing spread feature drift

**Next Steps:**
1. Monitor PR-AUC metrics over next 2 weeks via MLflow tracking
2. If PR-AUC drops > 5%, trigger model retraining with recent production data
3. Investigate spread calculation logic to ensure feature computation is correct
4. Re-generate report in 1 week to track drift trends

### [Previous Reports]

[Add previous drift reports here]

## Drift Response Procedure

### When Drift is Detected

1. **Review Report:** Open HTML report and identify drifted features
2. **Assess Impact:** Check model performance metrics (PR-AUC, accuracy)
3. **Investigate Root Cause:**
   - Market conditions changed?
   - Data collection issues?
   - Feature computation bugs?
4. **Take Action:**
   - **Low Drift:** Continue monitoring
   - **Medium Drift:** Schedule retraining within 2 weeks
   - **High Drift:** Immediate retraining or model rollback

### Model Retraining Trigger

Retrain model when:
- > 75% of features show drift
- Model performance (PR-AUC) drops > 5%
- Drift persists for > 2 weeks

## Monitoring Features

The following 10 features are monitored for drift (top features from Random Forest):

1. `log_return_300s`
2. `spread_mean_300s`
3. `trade_intensity_300s`
4. `order_book_imbalance_300s`
5. `spread_mean_60s`
6. `order_book_imbalance_60s`
7. `price_velocity_300s`
8. `realized_volatility_300s`
9. `order_book_imbalance_30s`
10. `realized_volatility_60s`

## Automation (Future)

Consider automating drift detection:
- **Cron Job:** Weekly report generation
- **Alerting:** Email/Slack notification on high drift
- **Integration:** Trigger retraining pipeline on drift detection

---

**Last Updated:** December 6, 2025
**Next Report:** December 13, 2025 (weekly monitoring)

